import{u as y,q as k,r,j as i,s as _}from"./app-Bn5ZfSvI.js";import{U as S}from"./index-11m7HO5M.js";import{I as h,R as I}from"./index-BHG36Dea.js";import"./button-C9QeMxcz.js";import"./index-B6tKUevl.js";import"./index-PB3c4EXd.js";import"./EyeOutlined-CVYzanNa.js";function T(){var m;const{ticket:s}=y(e=>e.tickets),{url:p}=k(),[f,d]=r.useState(!1),[u,c]=r.useState(""),[a,l]=r.useState([]);r.useEffect(()=>{var e;s!=null&&s.files&&l([...a,...(e=s==null?void 0:s.files)==null?void 0:e.map(t=>{var o;return{uid:t==null?void 0:t.id,name:"uploaded",url:t==null?void 0:t.url,status:"done",extension:(o=t==null?void 0:t.url)==null?void 0:o.split("/").pop().split(".").pop()}})])},[(m=s==null?void 0:s.files)==null?void 0:m.length]);const g=async e=>{try{if(e.extension=="pdf")window.open(e.url,"_blank");else if(e.extension=="docx"){const t=encodeURIComponent(e.url);window.open(`https://docs.google.com/gview?url=${t}&embedded=true`,"_blank")}else["mp4","webm","ogg","mov"].includes(e.extension)?window.open(e.url,"_blank"):(!e.url&&!e.preview&&(e.preview=await w(e.originFileObj)),c(e.url||e.preview),d(!0))}catch(t){console.error("Error handling file preview:",t)}},w=e=>new Promise((t,o)=>{const n=new FileReader;n.readAsDataURL(e),n.onload=()=>t(n.result),n.onerror=j=>o(j)});function v(e){return!e.some(o=>o.status!=="done")}async function b({fileList:e}){const t=new FormData,o=p.split("/")[p.split("/").length-2].split("#")[0];if(t.append("ticket_id",o=="tickets"?window.location.pathname.split("/")[3]:o),v(e))for(let n=0;n<e.length;n++)e[n].name!=="uploaded"&&e[n].status=="done"&&(t.append("files[]",e[n].originFileObj),l(e));else l(e);await _.dispatch(upload_ticket_files_thunk(t,o))}const x=i.jsxs("button",{style:{border:0,background:"none"},type:"button",children:[i.jsx(I,{}),i.jsx("div",{style:{marginTop:8},children:"Upload"})]});return i.jsxs("div",{children:[i.jsx(S,{disabled:!0,multiple:!0,method:"GET",action:"https://660d2bd96ddfa2943b33731c.mockapi.io/api/upload",listType:"picture",fileList:a,onPreview:g,onChange:b,children:a.length>=8?null:x}),u&&i.jsx(h.PreviewGroup,{preview:{visible:f,onVisibleChange:e=>d(e),afterOpenChange:e=>!e&&c("")},children:i.jsx(h,{wrapperStyle:{display:"none"},src:u})})]})}export{T as default};
